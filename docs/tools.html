<!doctype html>
<html class="no-js" lang="en-us" prefix="og: http://ogp.me/ns#">

<head>
    <meta charset="utf-8">
    <title>Tools | tweakflow - safe embeddable scripting language for the JVM</title>

    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    
    <meta name="description" content="" />

    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Droid+Serif|Lato|Roboto|Inconsolata">
    <link rel="stylesheet" href="./fontawesome/css/all.min.css">
    <link rel="stylesheet" href="./css/normalize.css">
    <link rel="stylesheet" href="./css/layout.css">
    <link rel="stylesheet" href="./css/style.css">

    <link rel="stylesheet" href="./js/highlight-tweakflow/tweakflow-light.css">

    <script type="text/javascript" src="./js/ie-shim.js"></script>
    <script type="text/javascript" src="./js/es6-shim.js"></script>
    <script type="text/javascript" src="./js/highlight/highlight.pack.js"></script>
    <script type="text/javascript" src="./js/highlight-tweakflow/tweakflow.js"></script>
    <script type="text/javascript">
      hljs.registerLanguage('tweakflow', window.hljsDefineTweakflow);
      hljs.configure({languages: ["xml", "tweakflow", "plaintext", "java"]});
      hljs.initHighlightingOnLoad();
    </script>

    <link rel="apple-touch-icon" sizes="180x180" href="./img/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="./img/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="./img/favicon-16x16.png">
    <link rel="manifest" href="./img/manifest.json">
    <link rel="mask-icon" href="./img/safari-pinned-tab.svg" color="#5bbad5">
    <link rel="shortcut icon" href="./img/favicon.ico">
    <meta name="msapplication-config" content="/img/browserconfig.xml">
    <meta name="theme-color" content="#ffffff">

    <meta name="apple-mobile-web-app-title" content="tweakflow - safe embeddable scripting language for the JVM">
    <meta name="application-name" content="tweakflow - safe embeddable scripting language for the JVM">

</head>


<body>
    <header>
  <div class="menu-narrow">
    <div class="dropdown">
      <div class="dropdown-trigger">
        <nav role="navigation" class="menu__items-wrapper-left">
        <ul class="menu__items">
          <li class="menu__item">
            <a class="menu__item-version-link"><i class="caret fas fa-fw fa-caret-right"></i><b>Tweakflow</b> v1.3.1</a>
          </li>
        </ul>
        </nav>
      </div>
      <div class="dropdown-menu" id="dropdown-menu-narrow" role="menu">
        <div class="dropdown-content">
          <a href="./index.html" class="dropdown-item">
            Home
          </a>
          
          
          
          <a class="dropdown-item" href="./getting-started.html">Getting started</a>
          
          <a class="dropdown-item" href="./tools.html">Tools</a>
          
          <a class="dropdown-item" href="./embedding.html">Embedding</a>
          
          <a class="dropdown-item" href="./reference.html">Reference</a>
          
          <a class="dropdown-item" href="./support.html">Support</a>
          
          
          <hr class="dropdown-divider" />
          
          
          
          <a class="dropdown-item" href="./modules/std.html">std</a>
          
          <a class="dropdown-item" href="./modules/std/spec.html">std/spec</a>
          
          <a class="dropdown-item" href="https://github.com/twineworks/tweakflow/">GitHub</a>
          
          <a class="dropdown-item" href="https://gitter.im/twineworks/tweakflow">Discuss</a>
          
          
        </div>
      </div>
    </div>
  </div>
  <div class="menu">
    
    
    
    <nav role="navigation" class="menu__items-wrapper-left">
      <ul class="menu__items">
        <li class="menu__item">
          <a class="menu__item-version-link" href="./index.html"
            ><b>Tweakflow</b> v1.3.1</a
          >
        </li>
        
        
        
        <li class="menu__item">
          <a class="menu__item-link" href="./getting-started.html">Getting started</a>
        </li>
        
        <li class="menu__item active">
          <a class="menu__item-link" href="./tools.html">Tools</a>
        </li>
        
        <li class="menu__item">
          <a class="menu__item-link" href="./embedding.html">Embedding</a>
        </li>
        
        <li class="menu__item">
          <a class="menu__item-link" href="./reference.html">Reference</a>
        </li>
        
        <li class="menu__item">
          <a class="menu__item-link" href="./support.html">Support</a>
        </li>
        
        
      </ul>
    </nav>
    <nav role="navigation" class="menu__items-wrapper-right">
      <ul class="menu__items">
        
        
        
        <li class="menu__item">
          <a class="menu__item-link" href="./modules/std.html">std</a>
        </li>
        
        <li class="menu__item">
          <a class="menu__item-link" href="./modules/std/spec.html">std/spec</a>
        </li>
        
        <li class="menu__item">
          <a class="menu__item-link" href="https://github.com/twineworks/tweakflow/">GitHub</a>
        </li>
        
        <li class="menu__item">
          <a class="menu__item-link" href="https://gitter.im/twineworks/tweakflow">Discuss</a>
        </li>
        
        
      </ul>
    </nav>
  </div>
</header>
<script type="text/javascript" src="./js/dropdown.js"></script>

    <div class="content-wrapper">
      
      <aside class="toc">
        <div class="toc-wrapper">
          <div class="scrollable-parent">
            <div class="scrollable-content">
              <nav id="TableOfContents">
<ul>
<li><a href="#language-tools">Language Tools</a>
<ul>
<li><a href="#interactive-repl">Interactive REPL</a>
<ul>
<li><a href="#evaluating-expressions">Evaluating expressions</a></li>
<li><a href="#multi-line-mode">Multi-line mode</a></li>
<li><a href="#defining-variables">Defining variables</a></li>
<li><a href="#inspecting-memory-contents">Inspecting memory contents</a></li>
<li><a href="#viewing-docs">Viewing docs</a></li>
<li><a href="#loading-modules">Loading modules</a></li>
<li><a href="#command-line-arguments">Command line arguments</a></li>
</ul></li>
<li><a href="#spec-runner">Spec runner</a>
<ul>
<li><a href="#running-spec-modules">Running spec modules</a></li>
<li><a href="#global-modules">Global modules</a></li>
<li><a href="#filtering-specs">Filtering specs</a></li>
<li><a href="#running-tagged-specs">Running tagged specs</a></li>
<li><a href="#reporters">Reporters</a>
<ul>
<li><a href="#multiple-reporters">Multiple reporters</a></li>
<li><a href="#reporter-options">Reporter options</a></li>
</ul></li>
<li><a href="#effects">Effects</a></li>
<li><a href="#standard-library-test-suite">Standard library test suite</a></li>
</ul></li>
<li><a href="#runner">Runner</a>
<ul>
<li><a href="#passing-string-arguments">Passing string arguments</a></li>
<li><a href="#passing-expression-arguments">Passing expression arguments</a></li>
<li><a href="#loading-custom-modules">Loading custom modules</a></li>
</ul></li>
<li><a href="#metadata-extraction">Metadata extraction</a>
<ul>
<li><a href="#command-overview">Command overview</a></li>
<li><a href="#printing-metadata">Printing metadata</a></li>
<li><a href="#transforming-metadata">Transforming metadata</a></li>
<li><a href="#processing-more-than-one-module">Processing more than one module</a></li>
<li><a href="#saving-the-output">Saving the output</a></li>
</ul></li>
</ul></li>
</ul>
</nav>
            </div>
          </div>
        </div>
      </aside>
      
      <main class="single-content " role="main">
        

<h1 id="language-tools">Language Tools</h1>

<p>The tweakflow jar offers entry points for some language tools that can be executed standalone. An interactive REPL, a spec runner that executes tests, a runner that evaluates all given modules and calls a main function, and a documentation tool that extracts doc and metadata from modules.</p>

<h2 id="interactive-repl">Interactive REPL</h2>

<p>To launch the REPL run:</p>

<pre><code class="language-bash">$ java -jar tweakflow-1.3.1.jar repl
</code></pre>

<p>The acronym <code>repl</code> stands for &lsquo;read evaluate process loop&rsquo;. You should see a prompt similar to this:</p>

<pre><code class="language-text">tweakflow interactive shell    \? for help, \q to quit
std.tf&gt;
</code></pre>

<p>You can quit out of the REPL by entering <code>\q</code>. To get help, enter <code>\?</code>. The help screen looks similar to this:</p>

<pre><code class="language-text">usage: &gt; COMMAND ...

interactive commands:
  COMMAND
    \help (\?)           show usage information
    \vars (\v)           print interactive variable definitions
    \edit (\e)           toggle multi-line entry
    \inspect (\i)        inspect memory space
    \load_path (\lp)     print load path
    \pwd                 print working directory
    \load (\l)           load a set of modules, removes interactive variables
    \meta (\m)           print meta data
    \doc (\d)            print doc
    \time (\t)           measure evaluation time
    ... snip ...
</code></pre>

<p>The commands are listed with a short description of what they do. To get more help for a particular command, just type it in with a <code>--help</code> argument.</p>

<p>To get help for the <code>\load</code> command:</p>

<pre><code class="language-text">&gt; \load --help
usage: &gt; \load module [module ...]

positional arguments:
  module                 modules to load, first given module's scope is entered, relative paths are searched in load_path
</code></pre>

<h3 id="evaluating-expressions">Evaluating expressions</h3>

<p>Just type in an expression to have the REPL evaluate it:</p>

<pre><code class="language-tweakflow">&gt; 1+2
3

&gt; &quot;Hello&quot;.. &quot; &quot; .. &quot;World&quot;
&quot;Hello World&quot;
</code></pre>

<p>The prompt shows you which module context you are in. You can reference all names visible in the module you are in. By default this is the standard library context, so you can use standard library functions.</p>

<pre><code class="language-tweakflow">std.tf&gt; data.map([1, 2, 3], (x) -&gt; x*x)
[1, 4, 9]

std.tf&gt; strings.length(&quot;foo&quot;)
3
</code></pre>

<h3 id="multi-line-mode">Multi-line mode</h3>

<p>The REPL accepts single line entry by default. If you want to use an expression that spans multiple lines, open multiline mode using <code>\e</code> and close it again using <code>\e</code>. The REPL indicates with a <code>*</code> in the prompt that it is in multi-line mode.</p>

<pre><code class="language-tweakflow">std.tf&gt; \e
std.tf* let {
std.tf*   a: 3;
std.tf*   b: 4;
std.tf* }
std.tf* a+b
std.tf* \e
7
std.tf&gt;
</code></pre>

<h3 id="defining-variables">Defining variables</h3>

<p>You can define interactive variables using <code>var_name: expression</code> syntax. You can then reference your variables in your expressions and definitions.</p>

<pre><code class="language-tweakflow">&gt; a: 3
3

&gt; b: 4
4

&gt; c: a+b
7
</code></pre>

<p>All variables are re-evaluated on each command, so changing a variable definition changes all dependent values.</p>

<pre><code class="language-tweakflow">&gt; x: 3
3

&gt; y: x
3

&gt; x: &quot;foo&quot;
&quot;foo&quot;

&gt; y
&quot;foo&quot;
</code></pre>

<p>You can view your interactive variable definitions using the <code>\vars</code> command.</p>

<pre><code class="language-tweakflow">&gt; \vars
5 interactive variables defined
a: 3
b: 4
c: a+b
x: &quot;foo&quot;
y: x
</code></pre>

<p>You can view their current values using the <code>\inspect</code> command.</p>

<pre><code class="language-tweakflow">&gt; \inspect
a: 3
b: 4
c: 7
`$`: &quot;foo&quot;
x: &quot;foo&quot;
y: &quot;foo&quot;
</code></pre>

<p>The <code>$</code> variable is internally maintained by the REPL to hold the last evaluation result. You can only view it using <code>\inspect</code>. It cannot be referenced in your expressions.</p>

<h3 id="inspecting-memory-contents">Inspecting memory contents</h3>

<p>You can inspect the content of any loaded module, library or variable. Just pass a reference to the <code>\inspect</code> command. To view the contents of the <code>strings</code> library, for example:</p>

<pre><code class="language-tweakflow">&gt; \i strings
# library
  starts_with?: function
  upper_case: function
  length: function
  replace: function
  concat: function
  ends_with?: function
  substring: function
  index_of: function
  comparator: function
  split: function
  trim: function
  lower_case: function
  join: function
  chars: function
  last_index_of: function
</code></pre>

<p>Enter <code>\i --help</code> for more information about the inspect command.</p>

<h3 id="viewing-docs">Viewing docs</h3>

<p>Tweakflow has the ability to annotate all named entities with doc data. You can view any doc data using the <code>\doc</code> command. The standard module, libraries and functions are annotated with markdown documentation.</p>

<pre><code class="language-text">&gt; \doc strings
The strings library contains basic functions for text processing.

&gt; \doc strings.length
`(string x) -&gt; long`

Returns the number of unicode codepoints in given string `x`.

Returns `nil` if `x` is `nil`.

​```tweakflow
&gt; strings.length(&quot;&quot;)
0

&gt; strings.length(&quot;foo&quot;)
3

&gt; strings.length(&quot;你好&quot;)
2
​```
</code></pre>

<h3 id="loading-modules">Loading modules</h3>

<p>You can load a different module than the standard library through the <code>\load</code> command. Let&rsquo;s say you have a module file on your disk:</p>

<pre><code class="language-tweakflow"># acme.tf

import data, regex, strings from 'std';

alias strings.replace as replace;
alias data.map as map;
alias data.slices as slices;
alias strings.join as join;
alias strings.upper_case as upper_case;

library product_codes {

  remove_whitespace:
    regex.replacing('\s+', &quot;&quot;); # function that removes any whitespace from a string

  normalize: (string x) -&gt;
    -&gt;&gt; (x)
        # remove whitespace, &quot;f-oo bar&quot; -&gt; &quot;f-oobar&quot;
        (x) -&gt; remove_whitespace(x),

        # remove any dashes # &quot;f-oobar&quot; -&gt; &quot;foobar&quot;
        (x) -&gt; replace(x, &quot;-&quot;, &quot;&quot;),

        # split to a list of blocks of up to 4 chars &quot;foobar&quot; -&gt; [&quot;foob&quot;, &quot;ar&quot;]
        (x) -&gt; let {
                 # &quot;foobar&quot; -&gt; [[&quot;f&quot;, &quot;o&quot;, &quot;o&quot;, &quot;b&quot;], [&quot;a&quot;, &quot;r&quot;]]
                 blocks: slices(x as list, 4);
               }
               # [[&quot;f&quot;, &quot;o&quot;, &quot;o&quot;, &quot;b&quot;], [&quot;a&quot;, &quot;r&quot;]] -&gt; [&quot;foob&quot;, &quot;ar&quot;]
               map(blocks, (block) -&gt; join(block)),

        # place dashes between blocks converting to single string [&quot;foob&quot;, &quot;ar&quot;] -&gt;   &quot;foob-ar&quot;
        (blocks) -&gt; join(blocks, &quot;-&quot;),

        # upper case all characters &quot;foob-ar&quot; -&gt; &quot;FOOB-AR&quot;
        upper_case;
}
</code></pre>

<p>Load it in the REPL:</p>

<pre><code class="language-tweakflow">&gt; \load acme.tf
acme.tf&gt;
</code></pre>

<p>You are now in the context of the acme module, and can reference all names in this module.</p>

<pre><code class="language-tweakflow">acme.tf&gt; product_codes.normalize(&quot;ah-78277-Nz&quot;)
&quot;AH78-277N-Z&quot;
</code></pre>

<h3 id="command-line-arguments">Command line arguments</h3>

<p>The REPL accepts a number of command line arguments that influence which modules are initially loaded, and which directories are placed on the load path. To learn more, run:</p>

<pre><code class="language-bash">$ java -jar tweakflow-1.3.1.jar repl --help
</code></pre>

<h2 id="spec-runner">Spec runner</h2>

<p>The spec runner runs modules that <a href="./reference.html#specs">contain tests</a>. You can specify which modules to include, which tests to execute, and how to format the output.</p>

<p>Run the following command to view the command line options:</p>

<pre><code class="language-bash">$ java -jar tweakflow-1.3.1.jar spec -h
</code></pre>

<h3 id="running-spec-modules">Running spec modules</h3>

<p>You specify the spec modules to run by supplying paths. If the given path is a file, it is run as a spec module.
If the given path is a directory, the runner recursively finds and runs all <code>*.spec.tf</code> files within that directory.</p>

<pre><code class="language-bash"># runs specific files
$ java -jar tweakflow-1.3.1.jar spec /path/to/t_1.spec.tf /path/to/t_2.spec.tf

# recursively runs all *.spec.tf files in ./tests
$ java -jar tweakflow-1.3.1.jar spec ./tests
</code></pre>

<h3 id="global-modules">Global modules</h3>

<p>You can include global modules to be available in specs using the <code>-g</code> switch.</p>

<pre><code class="language-bash"># include the ./conf/test.tf global module in each spec
$ java -jar tweakflow-1.3.1.jar spec -g ./conf/test.tf ./tests
</code></pre>

<h3 id="filtering-specs">Filtering specs</h3>

<p>Use the <code>-f</code> switch to execute only tests that contain the given string in their full name. A test&rsquo;s full name consists of all its parent describe block&rsquo;s names and its own name.</p>

<p>In order to recursively execute all tests in a given describe block you can specify the describe block&rsquo;s name as a filter.</p>

<p>In order to execute a single test only, you could specify a unique string from its own name.</p>

<p>You can specify multiple <code>-f</code> switches. A test must satisfy all filters in order to run.</p>

<pre><code class="language-bash"># only run tests that have 'nil' somewhere in their name
$ java -jar tweakflow-1.3.1.jar spec -f nil ./tests
</code></pre>

<h3 id="running-tagged-specs">Running tagged specs</h3>

<p>If you have tagged describe blocks or tests, they are not executed by default. You need to specify that you wish to run tagged tests by providing the desired tag using the <code>-t</code> switch.</p>

<pre><code class="language-bash"># run tests that are tagged 'nightly'
$ java -jar tweakflow-1.3.1.jar spec -t nightly ./tests
</code></pre>

<p>You can specify multiple <code>-t</code> switches. A test will run if it is tagged with any of the given tags.</p>

<p>If you specify a <code>-t</code> switch, untagged tests will not run. If you wish to include them, use the <code>--untagged</code> switch.</p>

<pre><code class="language-bash"># run regular test-suite plus nightly tests
$ java -jar tweakflow-1.3.1.jar spec --untagged -t nightly ./tests
</code></pre>

<h3 id="reporters">Reporters</h3>

<p>Spec reporters determine the output of a spec run. You can specify the reporter to use with the <code>-r</code> switch.</p>

<p>The following reporters are built-in:</p>

<table>
<thead>
<tr>
<th>Reporter</th>
<th>Output</th>
</tr>
</thead>

<tbody>
<tr>
<td>doc (default)</td>
<td>Hierarchical view of tests</td>
</tr>

<tr>
<td>dot</td>
<td>Minimal output with a single character printed for each test</td>
</tr>
</tbody>
</table>

<pre><code class="language-bash"># use the dot reporter
$ java -jar tweakflow-1.3.1.jar spec -r dot ./tests
</code></pre>

<p>You can specify your own reporter that implements the <a href="https://github.com/twineworks/tweakflow/blob/master/src/main/java/com/twineworks/tweakflow/spec/reporter/SpecReporter.java">SpecReporter</a> interface. Make sure your imeplementation is on the class path and provide the fully qualified class name.</p>

<pre><code class="language-bash"># use a custom reporter
$ java -cp &lt;your cp&gt; com.twineworks.tweakflow.Main spec -r com.your.ReporterClass ./tests
</code></pre>

<h4 id="multiple-reporters">Multiple reporters</h4>

<p>You can specify more than one reporter by supplying more than one <code>-r</code> switch. The specified reporters should not interfere with each other, for example one should write to console, while the other should generate a file.</p>

<h4 id="reporter-options">Reporter options</h4>

<p>You can supply options to reporters using <code>-ro &lt;OPTION_NAME&gt; &lt;OPTION_VALUE&gt;</code>. Options specified in this way are made available to all reporters as string properties.</p>

<p>The built-in reporters understand the following options:</p>

<table>
<thead>
<tr>
<th>Option</th>
<th>Values</th>
<th>Description</th>
</tr>
</thead>

<tbody>
<tr>
<td>color</td>
<td><code>true</code> / <code>false</code></td>
<td>whether reporter may use ANSI escape sequences to generate colored output</td>
</tr>

<tr>
<td>tty</td>
<td><code>true</code> / <code>false</code></td>
<td>whether reporter may use ANSI escape sequences for cursor repositioning, potentially enabling the use of console animation</td>
</tr>
</tbody>
</table>

<p>By default the runner tries to detect whether it runs on a console and enables the above options dynamically.</p>

<p>You can use the following shortucts for specifying reporter options:</p>

<ul>
<li>use <code>--color</code> as a shortcut for <code>-ro color true</code></li>
<li>use <code>--tty</code> as a shortcut for <code>-ro tty true</code></li>
</ul>

<h3 id="effects">Effects</h3>

<p>Tweakflow is side-effect free. If you wish to trigger side effects in the test suite, you can supply a set of effects by implementing the <a href="https://github.com/twineworks/tweakflow/blob/master/src/main/java/com/twineworks/tweakflow/spec/effects/SpecEffects.java">SpecEffects</a> interface. To use your class, use the <code>-e</code> switch and supply the fully qualified name of the class implementing the interface.</p>

<p>See the <a href="https://github.com/twineworks/tweakflow/blob/master/src/test/resources/spec/examples/effects.spec.tf">effects example module</a> for a demonstration on how to use effects. You can run the module using the following command:</p>

<pre><code class="language-bash">$ java -jar tweakflow-1.3.1.jar spec -e com.twineworks.tweakflow.spec.effects.example.ExampleEffects src/test/resources/spec/examples/effects.spec.tf
</code></pre>

<h3 id="standard-library-test-suite">Standard library test suite</h3>

<p>The test suite for the tweakflow standard library is located at <a href="https://github.com/twineworks/tweakflow/tree/master/src/test/resources/spec/std">src/test/resources/spec/std</a></p>

<p>You can run it with the following command:</p>

<pre><code class="language-bash">$ java -jar tweakflow-1.3.1.jar spec src/test/resources/spec/std
</code></pre>

<h2 id="runner">Runner</h2>

<p>The runner loads a module and calls a main function with some arguments you supply on the command line. It prints the return value back to the console.</p>

<p>Run the following command to view the command line options.</p>

<pre><code class="language-bash">$ java -jar tweakflow-1.3.1.jar run --help
</code></pre>

<p>The module(s) to load are given as positional arguments. You can pass <code>std</code> to load the standard module.</p>

<p>The main function to call is given using the <code>-m</code> switch in <code>library_name.var_name</code> format. It is a reference in module scope of the first passed module.</p>

<p>Arguments are given in order, using a series of <code>-a</code> and <code>-ea</code> switches. The <code>-a</code> switch takes the argument verbatim and turns it into a tweakflow string. The <code>-ea</code> switch treats the argument as an expression that is evaluated first, before it is passed on to the function.</p>

<h3 id="passing-string-arguments">Passing string arguments</h3>

<p>The following invocation calls <code>strings.length(&quot;foo&quot;)</code>:</p>

<pre><code class="language-bash">$ java -jar tweakflow-1.3.1.jar run -m strings.length -a foo std
3
</code></pre>

<p>Since the argument is a string, it is passed using the <code>-a</code> switch. Please note that passing the argument using the <code>-ea</code> switch would fail, since <code>foo</code> would simply be a reference to an undefined variable. If you wish to pass strings using <code>-ea</code>, you have to pass a proper literal string as in:</p>

<pre><code class="language-bash">$ java -jar tweakflow-1.3.1.jar run -m strings.length -ea &quot;'foo'&quot; std
3
</code></pre>

<p>Shell escaping can make it tricky to know exactly what is passed. It is therefore recommended to avoid the complexity and pass strings using <code>-a</code>.</p>

<h3 id="passing-expression-arguments">Passing expression arguments</h3>

<p>The following invocation calls <code>data.map([1, 2, 3, 4], (x) -&gt; x*x)</code>:</p>

<pre><code class="language-bash">$ java -jar tweakflow-1.3.1.jar run -m data.map -ea '[1, 2, 3, 4]' -ea '(x) -&gt; x*x' std
[1, 4, 9, 16]
</code></pre>

<p>This time both arguments need to be evaluated to a list and function first. Therefore the <code>-ea</code> switch is used both times.</p>

<h3 id="loading-custom-modules">Loading custom modules</h3>

<p>You can load any module on disk. Let&rsquo;s say you have the following module available:</p>

<pre><code class="language-tweakflow"># acme.tf

import data, regex, strings from 'std';

alias strings.replace as replace;
alias data.map as map;
alias data.slices as slices;
alias strings.join as join;
alias strings.upper_case as upper_case;

library product_codes {

  remove_whitespace:
    regex.replacing('\s+', &quot;&quot;); # function that removes any whitespace from a string

  normalize: (string x) -&gt;
    -&gt;&gt; (x)
        # remove whitespace, &quot;f-oo bar&quot; -&gt; &quot;f-oobar&quot;
        (x) -&gt; remove_whitespace(x),

        # remove any dashes # &quot;f-oobar&quot; -&gt; &quot;foobar&quot;
        (x) -&gt; replace(x, &quot;-&quot;, &quot;&quot;),

        # split to a list of blocks of up to 4 chars &quot;foobar&quot; -&gt; [&quot;foob&quot;, &quot;ar&quot;]
        (x) -&gt; let {
                 # &quot;foobar&quot; -&gt; [[&quot;f&quot;, &quot;o&quot;, &quot;o&quot;, &quot;b&quot;], [&quot;a&quot;, &quot;r&quot;]]
                 blocks: slices(x as list, 4);
               }
               # [[&quot;f&quot;, &quot;o&quot;, &quot;o&quot;, &quot;b&quot;], [&quot;a&quot;, &quot;r&quot;]] -&gt; [&quot;foob&quot;, &quot;ar&quot;]
               map(blocks, (block) -&gt; join(block)),

        # place dashes between blocks converting to single string [&quot;foob&quot;, &quot;ar&quot;] -&gt;   &quot;foob-ar&quot;
        (blocks) -&gt; join(blocks, &quot;-&quot;),

        # upper case all characters &quot;foob-ar&quot; -&gt; &quot;FOOB-AR&quot;
        upper_case;
}
</code></pre>

<p>To load it, and run <code>product_codes.normalize(&quot;ksh765fg25ff&quot;)</code>:</p>

<pre><code class="language-bash">$ java -jar tweakflow-1.3.1.jar run -m product_codes.normalize -a ksh765fg25ff acme.tf
KSH7-65FG-25FF
</code></pre>

<h2 id="metadata-extraction">Metadata extraction</h2>

<p>The tweakflow language allows annotating modules, libraries, and variables with documentation and custom meta data. The <code>doc</code> utility makes it possible to extract that information in a structured way.</p>

<p>Let&rsquo;s work with the following module file:</p>

<pre><code class="language-tweakflow"># module foo.tf
doc
~~~
This is documentation at the module level.
~~~
meta {
  :title       &quot;foo&quot;,
  :description &quot;Description of the module&quot;,
  :version     &quot;4.2&quot;
}
module;

# library bar
doc 'This is documentation for library bar.'

meta {
  :author &quot;John Doe et al.&quot;,
  :since  &quot;2.3&quot;
}

library bar {

  # function baz
  doc 'This is documentation for function baz.'

  meta {
    :author &quot;John Doe&quot;,
    :date 2017-03-12T
  }

  function baz: (x) -&gt; x*x;
}
</code></pre>

<h3 id="command-overview">Command overview</h3>

<p>You can view all command line switches by running the following:</p>

<pre><code class="language-bash">$ java -jar tweakflow-1.3.1.jar doc --help
</code></pre>

<p>The next sections provide a walkthrough for the most common options.</p>

<h3 id="printing-metadata">Printing metadata</h3>

<p>The following invokes <code>doc</code>, passing in the module to extract metadata from.</p>

<pre><code class="language-bash">$ java -jar tweakflow-1.3.1.jar doc foo.tf
</code></pre>

<p>By default the <code>doc</code> utility prints the structure of available meta data:</p>

<pre><code class="language-text">{
  :node &quot;module&quot;,
  :global false,
  :components [{
    :node &quot;library&quot;,
    :meta {
      :author &quot;John Doe et al.&quot;,
      :since &quot;2.3&quot;
    },
    :name &quot;bar&quot;,
    :vars [{
      :node &quot;var&quot;,
      :meta {
        :author &quot;John Doe&quot;,
        :date 2017-03-12T00:00:00Z@UTC
      },
      :name &quot;baz&quot;,
      :type &quot;function&quot;,
      :doc &quot;This is documentation for function baz.&quot;,
      :expression &quot;(x) -&gt; x*x&quot;
    }],
    :export false,
    :doc &quot;This is documentation for library bar.&quot;
  }],
  :doc &quot;This is documentation at the module level.&quot;,
  :file &quot;foo.tf&quot;,
  :path &quot;/Users/slawo/Desktop/docs_check/foo.tf&quot;,
  :meta {
    :description &quot;Description of the module&quot;,
    :version &quot;4.2&quot;,
    :title &quot;foo&quot;
  }
}
</code></pre>

<p>Please note that the output is a valid tweakflow dict value.</p>

<h3 id="transforming-metadata">Transforming metadata</h3>

<p>The <code>doc</code> utility can pass the meta data of a module to a sequence of transformer functions. The most common task for a transformer is to generate some human-readable document format from the given structure.</p>

<p>A transformer is a special tweakflow module that has a library named <code>transform</code> which in turn has a variable named <code>transform</code>. This variable holds a function accepting above structure as its sole argument. The return value of the function is the output of the transformer.</p>

<p>You supply transformers using the <code>-t</code> switch. If you supply more than one transformer, they are chained such that the output of the first transformer becomes the argument to the second transformer, and so on.</p>

<p>Let&rsquo;s supply a basic transformer that just generates a one-sentence summary of the module.</p>

<pre><code class="language-tweakflow"># transformer.tf
import data, strings from &quot;std&quot;;

alias data.size as size;
alias data.reduce as reduce;

library transform {

  transform: (dict x) -&gt; string
    &quot;Module &quot;
      ..x[:path]
      ..&quot; contains &quot;
      ..libs_in_module(x)
      ..&quot; libraries, and a total of &quot;
      ..vars_in_module(x)
      ..&quot; variables.&quot;;

  libs_in_module: (dict m) -&gt; long
    size(m[:components]);

  vars_in_module: (dict m) -&gt; long
    let {
      libs: m[:components];
    }
    reduce(libs, 0, (a, lib) -&gt; a+vars_in_lib(lib));

  vars_in_lib: (dict lib) -&gt; long
    size(lib[:vars]);
}
</code></pre>

<p>Let&rsquo;s run this transformer over the standard library:</p>

<pre><code class="language-bash">$ java -jar tweakflow-1.3.1.jar doc -t transformer.tf std
Module std.tf contains 8 libraries, and a total of 159 variables.
</code></pre>

<p>A more sophisticated transformer might generate markdown, XML, or HTML documentation for the module.</p>

<h3 id="processing-more-than-one-module">Processing more than one module</h3>

<p>You can pass more than one module to <code>doc</code>, and they are processed in order.</p>

<pre><code class="language-bash">$ java -jar tweakflow-1.3.1.jar doc -t transformer.tf std foo.tf
Module std.tf contains 8 libraries, and a total of 159 variables.
Module /path/to/foo.tf contains 1 libraries, and a total of 1 variables.
</code></pre>

<h3 id="saving-the-output">Saving the output</h3>

<p>If you&rsquo;re supplying relative module paths to <code>doc</code>, you can ask to save each module output to a base output directory, preserving the relative paths given. You can also specify a file extension to use, which is handy if your transformer generates a well known file format. The default extension is <code>txt</code>.</p>

<p>Assuming foo.tf is in the current directory, run:</p>

<pre><code class="language-bash">$ java -jar tweakflow-1.3.1.jar doc -t transformer.tf --output docs --output-extension md std.tf foo.tf
</code></pre>

<p>It generates a <code>docs</code> directory, placing the following files in there:</p>

<p><code>docs/std.tf.md</code></p>

<pre><code class="language-text">Module std.tf contains 8 libraries, and a total of 167 variables.
</code></pre>

<p><code>docs/foo.tf.md</code></p>

<pre><code class="language-text">Module /path/to/foo.tf contains 1 libraries, and a total of 1 variables.
</code></pre>

        
<footer>
  <div class="footer__copyright">
    © <a href="http://twineworks.com">Twineworks 2020</a>
  </div>
  <div class="footer__social"></div>
  <div class="footer__links">
    <a href="./legal_notice.html">Legal notice</a>
  </div>
</footer>

      </main>
    </div>

    

</body>

</html>
